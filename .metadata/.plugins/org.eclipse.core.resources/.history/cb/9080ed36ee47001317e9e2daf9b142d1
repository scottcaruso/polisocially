package com.scottcaruso.polisocially;

import com.scottcaruso.utilities.Connection_Verification;

import android.os.Bundle;
import android.app.Activity;
import android.app.AlertDialog;
import android.view.Menu;
import android.view.MenuItem;

public class Main_Screen extends Activity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main__screen);
       
    }


    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        // Inflate the menu; this adds items to the action bar if it is present.
        getMenuInflater().inflate(R.menu.main__screen, menu);
        return true;
    }
    
    @Override
    public boolean onOptionsItemSelected(MenuItem item){
    	this.createAlert();
    	return true;
    }
    
    
    public void createAlert() {
    	AlertDialog.Builder alert = new AlertDialog.Builder(this);
        alert.setMessage(R.string.about_app);
		AlertDialog alertDialog = alert.create();

		alertDialog.show();  
    }
    
    public boolean connectionExists() {
    	Boolean connected = Connection_Verification.areWeConnected(this);
    	
    }
    
    Boolean connected = Connection_Verification.areWeConnected(getCurrentContext());
	if (connected)
	{
		Log.i("Info","Connection established.");
		String enteredZip = zipEntry.getText().toString();
		Handler retrievalHandler = new Handler()
		{
			@Override
			public void handleMessage(Message msg) 
			{
				if (msg.arg1 == RESULT_OK)
				{
					try {
						response = (String) msg.obj;
					} catch (Exception e) {
						Log.e("Error","There was a problem retrieving the json Response.");
					}
					String nullResponse = "{\"results\":[],\"count\":0}";
					if (response.equals(nullResponse))
					{
						Toast toast = Toast.makeText(MainActivity.getCurrentContext(), "You have entered an invalid zip code. Please try again.", Toast.LENGTH_LONG);
						toast.show();
					} else
					{
						//DisplayPoliticianResults.showPoliticiansInMainView(jsonResponse, false);
						Intent nextActivity = new Intent(MainActivity.getCurrentContext(),DisplayResultsActivity.class);
						nextActivity.putExtra("favorites", false);
						nextActivity.putExtra("response", response);
						Activity currentActivity = (Activity) getCurrentContext();
						currentActivity.startActivityForResult(nextActivity, 0);
					}
				}
			}
		};
		Log.i("Info","Handler created.");
		
		Messenger apiMessenger = new Messenger(retrievalHandler);
		
		Intent startDataService = new Intent(getCurrentContext(), DataRetrievalService.class);
		Log.i("Info","Intent to start data service started.");
		startDataService.putExtra(DataRetrievalService.MESSENGER_KEY, apiMessenger);
		startDataService.putExtra(DataRetrievalService.ZIP_KEY,enteredZip);
		Log.i("Info","Put Messenger and Zip Code into Data Service intent.");
		getCurrentContext().startService(startDataService);
	
	} else
	{
		Log.i("Info","No internet connection found.");
		Toast toast = Toast.makeText(getCurrentContext(), "There is no connection to the internet available. Please try again later, or view saved politicians.", Toast.LENGTH_LONG);
		toast.show();
	}
    
}
